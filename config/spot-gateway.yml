spring:
  cloud:
    gateway:
      server:
        webflux:
          metrics:
            enabled: true
          httpclient:
            wiretap: false
            response-timeout: 5s
          httpserver:
            wiretap: false
          routes:
            # ==================== OpenAPI Routes ====================
            - id: user-api-docs
              uri: http://spot-user:8081
              predicates:
                - Path=/v3/api-docs/user
              filters:
                - RewritePath=/v3/api-docs/user, /v3/api-docs

            - id: order-api-docs
              uri: http://spot-order:8082
              predicates:
                - Path=/v3/api-docs/order
              filters:
                - RewritePath=/v3/api-docs/order, /v3/api-docs

            - id: store-api-docs
              uri: http://spot-store:8083
              predicates:
                - Path=/v3/api-docs/store
              filters:
                - RewritePath=/v3/api-docs/store, /v3/api-docs

            - id: payment-api-docs
              uri: http://spot-payment:8084
              predicates:
                - Path=/v3/api-docs/payment
              filters:
                - RewritePath=/v3/api-docs/payment, /v3/api-docs

            # ==================== API Routes ====================
            - id: user-auth
              uri: http://spot-user:8081
              predicates:
                - Path=/api/login,/api/join,/api/auth/refresh
              metadata:
                response-timeout: 5000
                connect-timeout: 3000

            - id: user-service
              uri: http://spot-user:8081
              predicates:
                - Path=/api/users/**,/api/admin/**

            - id: order-service
              uri: http://spot-order:8082
              predicates:
                - Path=/api/orders/**

            - id: store-service
              uri: http://spot-store:8083
              predicates:
                - Path=/api/stores/**,/api/categories/**,/api/reviews/**

            - id: payment-service
              uri: http://spot-payment:8084
              predicates:
                - Path=/api/payments/**

            - id: block-internal
              uri: http://localhost:9999
              predicates:
                - Path=/internal/**
              filters:
                - SetStatus=403

# ==================== SpringDoc OpenAPI (통합 Swagger) ====================
springdoc:
  swagger-ui:
    urls:
      - name: User Service
        url: /v3/api-docs/user
      - name: Store Service
        url: /v3/api-docs/store
      - name: Order Service
        url: /v3/api-docs/order
      - name: Payment Service
        url: /v3/api-docs/payment
    urls-primary-name: User Service

logging:
  level:
    org.springframework.boot.context.config: INFO
    org.springframework.cloud.gateway: INFO
    org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator: INFO
    org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping: INFO
    org.springframework.cloud.gateway.filter.headers.observation: WARN

management:
  endpoints:
    web:
      exposure:
        include: "*"
  metrics:
    tags:
      application: ${spring.application.name}
  observations:
    key-values:
      application: ${spring.application.name}
  tracing:
    sampling:
      probability: 1.0
